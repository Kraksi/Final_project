# COVID-19 Analysis Pipeline

–ü—Ä–æ–µ–∫—Ç –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä—É–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫—É –∏ –∞–Ω–∞–ª–∏–∑ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö COVID-19 —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Hadoop, Spark –∏ PySpark. –í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ —Ä–∞–±–æ—Ç—ã —Å—Ç—Ä–æ—è—Ç—Å—è –æ—Ç—á—ë—Ç—ã –∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–æ —ç–ø–∏–¥–µ–º–∏–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–º –¥–∞–Ω–Ω—ã–º, –≤—ã–≥—Ä—É–∂–∞—é—Ç—Å—è parquet-—Ñ–∞–π–ª—ã –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–∏.

‚ÑπÔ∏è –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

–ü—Ä–æ–µ–∫—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π ETL-–ø–∞–π–ø–ª–∞–π–Ω –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö COVID-19. –û—Å–Ω–æ–≤–Ω—ã–µ —ç—Ç–∞–ø—ã –ø–∞–π–ø–ª–∞–π–Ω–∞:

#### 1. –ó–∞–≥—Ä—É–∑–∫–∞ —Å—ã—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ HDFS

#### 2. –ü—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞ CSV-—Ñ–∞–π–ª–æ–≤ (–æ—á–∏—Å—Ç–∫–∞, —É–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è –¥–∏–∞–≥–Ω–æ–∑–æ–≤)

#### 3. –°–æ–∑–¥–∞–Ω–∏–µ Hive-—Ç–∞–±–ª–∏—Ü —Å –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∏ –±–∞–∫–µ—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º

#### 4. SQL-–∞–Ω–∞–ª–∏—Ç–∏–∫–∞ (–æ–∫–Ω–∞, join-–æ–ø–µ—Ä–∞—Ü–∏–∏, –∞–≥—Ä–µ–≥–∞—Ü–∏–∏)

#### 5. PySpark UDF-–æ–±—Ä–∞–±–æ—Ç–∫–∞

#### 6. –ú–∞—à–∏–Ω–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ (–∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è KMeans)

#### 7. –í—ã–≥—Ä—É–∑–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ Parquet

#### 8. –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –≤ Jupyter Notebook

# –¶–µ–ª—å –ø—Ä–æ–µ–∫—Ç–∞ ‚Äî –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—Ç—á—ë—Ç–æ–≤ –∏ BI-–ø–ª–∞—Ç—Ñ–æ—Ä–º.

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
```bash
FINAL_PROJECT/
‚îÇ
‚îú‚îÄ‚îÄ docker_data/
‚îÇ   ‚îú‚îÄ‚îÄ images/                         # –ò—Å—Ö–æ–¥–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è)
‚îÇ   ‚îú‚îÄ‚îÄ clean_metadata.py               # –°–∫—Ä–∏–ø—Ç –æ—á–∏—Å—Ç–∫–∏ CSV-—Ñ–∞–π–ª–∞
‚îÇ   ‚îú‚îÄ‚îÄ covid_full_pipeline.py          # –û—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç PySpark-–ø–∞–π–ø–ª–∞–π–Ω–∞
‚îÇ   ‚îú‚îÄ‚îÄ metadata.csv                    # –ò—Å—Ö–æ–¥–Ω—ã–π CSV —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏
‚îÇ   ‚îú‚îÄ‚îÄ metadata_cleaned.csv            # –û—á–∏—â–µ–Ω–Ω—ã–π CSV-—Ñ–∞–π–ª
‚îÇ   ‚îú‚îÄ‚îÄ requirements-docker.txt         # Python-–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
‚îÇ
‚îú‚îÄ‚îÄ results/                            # –ò—Ç–æ–≥–æ–≤—ã–µ parquet-—Ñ–∞–π–ª—ã –ø–æ—Å–ª–µ –ø–∞–π–ø–ª–∞–π–Ω–∞
‚îÇ   ‚îú‚îÄ‚îÄ covid_only.parquet
‚îÇ   ‚îú‚îÄ‚îÄ kmeans_clusters.parquet
‚îÇ   ‚îú‚îÄ‚îÄ metadata_with_udf.parquet
‚îÇ   ‚îú‚îÄ‚îÄ query1_top_patients.parquet
‚îÇ   ‚îú‚îÄ‚îÄ query2_views_join.parquet
‚îÇ   ‚îú‚îÄ‚îÄ query3_covid_stats.parquet
‚îÇ
‚îú‚îÄ‚îÄ venv/                               # –í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ Python (–ª–æ–∫–∞–ª—å–Ω–æ)
‚îÇ
‚îú‚îÄ‚îÄ .gitignore
‚îú‚îÄ‚îÄ docker-compose.yml                  # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤ Docker
‚îú‚îÄ‚îÄ init_hdfs.py                        # –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤ –≤ HDFS
‚îú‚îÄ‚îÄ report.ipynb                        # Jupyter Notebook –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ –∞–Ω–∞–ª–∏–∑–∞
‚îú‚îÄ‚îÄ requirements.txt                    # Python-–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –¥–ª—è Jupyter
‚îú‚îÄ‚îÄ spark.Dockerfile                    # Dockerfile –¥–ª—è Spark
‚îî‚îÄ‚îÄ README.md
```
## üöÄ –ü–æ–ª–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –∑–∞–ø—É—Å–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞

### 1. –°–±–æ—Ä–∫–∞ Docker-–æ–±—Ä–∞–∑–æ–≤
```bash
docker-compose build
```
### 2. –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –≤ —Ñ–æ–Ω–µ
```bash
docker-compose up -d
```
### 3. –°–æ–∑–¥–∞–Ω–∏–µ –∏ –∞–∫—Ç–∏–≤–∞—Ü–∏—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è + —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

Windows:
```powershell
python3 -m venv venv
.\venv\Scripts\activate
pip install -r requirements.txt
```
### 4. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è HDFS
–°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π –≤ HDFS –∏ –∑–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ö–æ–¥–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤:
```bash
python init_hdfs.py
```
### 5. –û—á–∏—Å—Ç–∫–∞ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ CSV
–û—á–∏—Å—Ç–∫–∞ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö-—Ñ–∞–π–ª–∞:
```bash
python docker_data/clean_metadata.py
```
### 6. –í—Ö–æ–¥ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä Spark
```bash
docker exec -it spark bash
```
### 7. –ó–∞–ø—É—Å–∫ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø–∞–π–ø–ª–∞–π–Ω–∞ PySpark
–í–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ Spark:
```bash
spark-submit /tmp/covid_full_pipeline.py
```
–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø–∞–π–ø–ª–∞–π–Ω–∞ –≤—ã–π—Ç–∏ –∏–∑ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:
```bash
exit
```
### 8. –í—Ö–æ–¥ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä NameNode
```bash
docker exec -it namenode bash
```
### 9. –í—ã–≥—Ä—É–∑–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∏–∑ HDFS –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
–í–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ namenode –≤—ã–ø–æ–ª–Ω–∏—Ç—å:
```bash
hdfs dfs -get /covid_dataset/processed/covid_only.parquet /data/results/covid_only.parquet
hdfs dfs -get /covid_dataset/processed/kmeans_clusters.parquet /data/results/kmeans_clusters.parquet
hdfs dfs -get /covid_dataset/processed/metadata_with_udf.parquet /data/results/metadata_with_udf.parquet
hdfs dfs -get /covid_dataset/processed/query1_top_patients.parquet /data/results/query1_top_patients.parquet
hdfs dfs -get /covid_dataset/processed/query2_views_join.parquet /data/results/query2_views_join.parquet
hdfs dfs -get /covid_dataset/processed/query3_covid_stats.parquet /data/results/query3_covid_stats.parquet
```
üí° –ú–æ–∂–Ω–æ —Å–∫–∞—á–∞—Ç—å –≤—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞–∑–æ–º:
```bash
hdfs dfs -get /covid_dataset/processed /data/results
```
–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø–∞–π–ø–ª–∞–π–Ω–∞ –≤—ã–π—Ç–∏ –∏–∑ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:
```bash
exit
```
### 10. –í—ã–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ —Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –Ω–∞ —Ö–æ—Å—Ç-–º–∞—à–∏–Ω—É
–î–ª—è Windows (–ø—Ä–∏–º–µ—Ä):
```powershell
docker cp namenode:/data/results C:\Project\
```
–î–ª—è Linux:
```bash
docker cp namenode:/data/results /home/user/Project/
```
## ‚úÖ –ü–æ—Å–ª–µ –≤—ã–≥—Ä—É–∑–∫–∏
–í—Å–µ parquet-—Ñ–∞–π–ª—ã –±—É–¥—É—Ç –Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –≤ –ø–∞–ø–∫–µ:
```text
FINAL_PROJECT/results
```
–Ω–∞ –≤–∞—à–µ–π —Ö–æ—Å—Ç-–º–∞—à–∏–Ω–µ. –≠—Ç–∏ –¥–∞–Ω–Ω—ã–µ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–π –∏ –∞–Ω–∞–ª–∏–∑–∞ –≤ Jupyter Notebook –∏–ª–∏ –¥—Ä—É–≥–∏—Ö BI-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞—Ö.

üìä –†–∞–±–æ—Ç–∞ —Å –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è–º–∏

–ó–∞–ø—É—Å—Ç–∏—Ç–µ Jupyter Notebook:
```text
report.ipynb
```
